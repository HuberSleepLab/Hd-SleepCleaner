# What this repository is about

This is an advanced semi-automatic artifact removal procedure based on [Huber et al., 2000](https://journals.lww.com/neuroreport/Fulltext/2000/10200/Exposure_to_pulsed_high_frequency_electromagnetic.12.aspx?casa_token=rmSXsQLiWZcAAAAA:9g0JXdXUpAJycVWzDSCLXKynmKeGpbXGJvZkrRGzSw5tifqkBLWYyfESIq4814-SpcqtBomfWBGnYf1-wyrbWbak). As for sleep scoring, the procedure segmented the EEG into 20 s epochs. For each channel in each sleep staged N1, N2, and N3 epoch, spectral power as well as the maximum squared deviation in amplitude from the average EEG signal was computed. Values from all channels and all NREM epochs were then visualized in one figure and outliers were identified, both manually and automatically. Visualizing all channels and epochs altogether has the advantage that extreme values can be both identified in respect to values of neighboring epochs, as well as values from other channels in the same epoch.

Most artifacts are present either in the delta (0.5 – 4.5 Hz) or beta (20 – 30 Hz) frequency range, which is why we used both frequency ranges to identify artifacts. To compare spectral power of different channels altogether, power spectral density (PSD) values, from which spectral power was computed, were first robustly Z-standardized over epochs (separately for each channel and frequency bin). Robust Z-standardization uses the median and inter-quartile-range (IQR) instead of the mean and standard deviation and is therefore robust towards extreme values which are naturally present in artifact-contaminated spectral power values. PSD was computed using the pwelch() function in Matlab (Welch method, 4 s Hanning windows, 50% overlap, frequency resolution 0.25 Hz). 

Remaining artifacts outside of those frequency ranges were thereafter identified based on the maximum squared deviation in amplitude of one channel from the average EEG signal. To do so, the EEG was robustly Z-standardized over sample points (separately for each channel) to compare the deviation in amplitude of different channels altogether.

Eventually, a channel was removed in a respective epoch when it contained an artifact. First, artifacts were identified using robustly Z-standardized delta power, thereafter using robustly Z-standardized beta power, and finally using the maximum squared deviation in amplitude from the average robustly Z-standardized EEG signal. Two automatic outlier detection procedures supported the artifact removal routine in the background. More specifically, outliers were detected 1) channel-wise when epochs deviated more than x standard deviations from a moving average of 40 epochs and 2) epoch-wise, when channels deviated more than x standard deviations from the average of all channels. Thresholds were adapted for each night but were usually situated between 8 and 12 standard deviations.

Thereafter, channels were interpolated in those epochs in which they were labeled as bad. In case more than 3 neighboring channels were classified as bad, however, the entire epoch was instead rejected. With this method, only a minimal amound of NREM epochs need to be rejected due to poor data quality. Besides, epochs in which only certain channels show artifacts can be analyzed by interpolating artifact-contaminated channels.
